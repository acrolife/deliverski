FROM node:16.19.0-slim as intermediate

MAINTAINER ITHouse <aivils@ithouse.io>

WORKDIR /app

COPY package.json /app
COPY yarn.lock /app

RUN apt-get update
RUN apt-get install -y git
RUN yarn install --network-concurrency 1

FROM node:16.19.0-slim
WORKDIR /app
COPY --from=intermediate /app /app

ARG REACT_APP_SHARETRIBE_SDK_CLIENT_ID
ARG REACT_APP_GOOGLE_MAPS_API_KEY
ARG REACT_APP_STRIPE_PUBLISHABLE_KEY
ARG REACT_APP_SHARETRIBE_SDK_BASE_URL
ARG REACT_APP_AVAILABILITY_ENABLED
ARG REACT_APP_SHARETRIBE_MARKETPLACE_CURRENCY
ARG REACT_APP_CANONICAL_ROOT_URL
ARG REACT_APP_MAPBOX_ACCESS_TOKEN
ARG REACT_APP_MIN_CHECKOUT_AMOUNT
ARG REACT_APP_SHIPPING_PROVIDER
ARG REACT_APP_SHIPPING_CUSTOMER
ARG REACT_APP_MARKETPLACECOMMISION
ARG REACT_APP_LOCALE
ARG REACT_APP_LOCALE_SWITCH
ARG REACT_APP_ONESIGNAL_APP_ID
ARG REACT_APP_ONESIGNAL_SAFARI_WEB_ID
ARG REACT_APP_ONESIGNAL_DEBUG

ENV REACT_APP_SHARETRIBE_SDK_CLIENT_ID=$REACT_APP_SHARETRIBE_SDK_CLIENT_ID
ENV REACT_APP_GOOGLE_MAPS_API_KEY=$REACT_APP_GOOGLE_MAPS_API_KEY
ENV REACT_APP_STRIPE_PUBLISHABLE_KEY=$REACT_APP_STRIPE_PUBLISHABLE_KEY
ENV REACT_APP_SHARETRIBE_SDK_BASE_URL=$REACT_APP_SHARETRIBE_SDK_BASE_URL
ENV REACT_APP_AVAILABILITY_ENABLED=$REACT_APP_AVAILABILITY_ENABLED
ENV REACT_APP_SHARETRIBE_MARKETPLACE_CURRENCY=$REACT_APP_SHARETRIBE_MARKETPLACE_CURRENCY
ENV REACT_APP_CANONICAL_ROOT_URL=$REACT_APP_CANONICAL_ROOT_URL
ENV REACT_APP_MAPBOX_ACCESS_TOKEN=$REACT_APP_MAPBOX_ACCESS_TOKEN
ENV REACT_APP_ENV=production
ENV REACT_APP_MIN_CHECKOUT_AMOUNT=$REACT_APP_MIN_CHECKOUT_AMOUNT
ENV REACT_APP_SHIPPING_PROVIDER=$REACT_APP_SHIPPING_PROVIDER
ENV REACT_APP_SHIPPING_CUSTOMER=$REACT_APP_SHIPPING_CUSTOMER
ENV REACT_APP_MARKETPLACECOMMISION=$REACT_APP_MARKETPLACECOMMISION
ENV REACT_APP_LOCALE=$REACT_APP_LOCALE
ENV REACT_APP_LOCALE_SWITCH=$REACT_APP_LOCALE_SWITCH
ENV REACT_APP_ONESIGNAL_APP_ID=$REACT_APP_ONESIGNAL_APP_ID
ENV REACT_APP_ONESIGNAL_SAFARI_WEB_ID=$REACT_APP_ONESIGNAL_SAFARI_WEB_ID
ENV REACT_APP_ONESIGNAL_DEBUG=$REACT_APP_ONESIGNAL_DEBUG

COPY . /app
RUN yarn run build
